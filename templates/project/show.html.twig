{% extends 'base.html.twig' %}



{% block title %}My project{% endblock %}

{% block body %}
<style>

body{

}

#backgroundDiv{

   width: 100vw;

  

   display: flex;

   flex-direction: column;

   align-items: center;

}



#flaskLogo{

   height: 300px;

   width: auto;

   
}


#chartLink{

position: absolute;

top: 75vh;

right: 6vw;

}
#dailyCntHTML{

   width: 90vw;
}


#startBtn{

position: absolute;

top: 75vh;

left: 48vw;

background: none;

border: none;

outline: none;

color: white;

   
}

#totalProgress{
   position: absolute;

   top: 43%;

   left: 48%;

   font-size: 40px;


}




body {
  width: 100%;
  position: relative;
  padding: 0;
  margin: 0;
}
.mo-fire {

     opacity:0;

  width: 60px;
  height: auto;
  position: absolute;

  margin-top: -25px;

  margin-left: 130px;
}
.mo-fire svg {
  width: 100%;
  height: auto;
  position: relative
}
.flame {
  animation-name: flamefly;
  animation-duration: 2s;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
  opacity: 0;
  transform-origin: 50% 50% 0;
}
.flame.one {
  animation-delay: 1s;
  animation-duration: 3s;
}
.flame3.two{
  animation-duration: 5s;
  animation-delay: 1s;
}

.flame-main {
  animation-name: flameWobble;
  animation-duration: 3s;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
}
.flame-main.one {
  animation-duration: 4s;
  animation-delay: 1s;
}
.flame-main.two {
  animation-duration: 3s;
  animation-delay: 2s;
}
.flame-main.three {
  animation-duration: 2.1s;
  animation-delay: 3s;
}
.flame-main.four {
  animation-duration: 3.2s;
  animation-delay: 4s;
}
.flame-main.five {
  animation-duration: 2.5s;
  animation-delay: 5s;
}
@keyframes flameWobble {
  50% {
    transform: scale(1,1.2) translate(0, -30px) rotate(-2deg);
  }
}
@keyframes flamefly {
  0%{
    transform: translate(0) rotate(180deg);
  }
   50% {
     opacity: 1;
  }
  100% {
    transform: translate(-20px, -100px) rotate(180deg);
    opacity: 0;
  }







</style>

<br>



<div id='backgroundDiv'>

  
  


   <div>


   
     <img id ='flaskLogo' src='{{ asset("images/lab.png") }}'> 

     <div id='totalProgress'></div>

     

    <div class="mo-fire" id='fireLogo'>
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="125px" height="189.864px" viewBox="0 0 125 189.864" enable-background="new 0 0 125 189.864" xml:space="preserve">
        <path class="flame-main" fill="#F36E21" d="M76.553,186.09c0,0-10.178-2.976-15.325-8.226s-9.278-16.82-9.278-16.82s-0.241-6.647-4.136-18.465
	c0,0,3.357,4.969,5.103,9.938c0,0-5.305-21.086,1.712-30.418c7.017-9.333,0.571-35.654-2.25-37.534c0,0,13.07,5.64,19.875,47.54
	c6.806,41.899,16.831,45.301,6.088,53.985"/>
       <path class="flame-main one" fill="#F6891F" d="M61.693,122.257c4.117-15.4,12.097-14.487-11.589-60.872c0,0,32.016,10.223,52.601,63.123
	c20.585,52.899-19.848,61.045-19.643,61.582c0.206,0.537-19.401-0.269-14.835-18.532S57.576,137.656,61.693,122.257z"/>
      <path class="flame-main two" fill="#FFD04A" d="M81.657,79.192c0,0,11.549,24.845,3.626,40.02c-7.924,15.175-21.126,41.899-0.425,64.998
	C84.858,184.21,125.705,150.905,81.657,79.192z"/>
      <path class="flame-main three" fill="#FDBA16" d="M99.92,101.754c0,0-23.208,47.027-12.043,80.072c0,0,32.741-16.073,20.108-45.79
	C95.354,106.319,99.92,114.108,99.92,101.754z"/>
     <path class="flame-main four" fill="#F36E21" d="M103.143,105.917c0,0,8.927,30.753-1.043,46.868c-9.969,16.115-14.799,29.041-14.799,29.041
	S134.387,164.603,103.143,105.917z"/>
        <path class="flame-main five" fill="#FDBA16" d="M62.049,104.171c0,0-15.645,67.588,10.529,77.655C98.753,191.894,69.033,130.761,62.049,104.171z"/>
        <path class="flame" fill="#F36E21" d="M101.011,112.926c0,0,8.973,10.519,4.556,16.543C99.37,129.735,106.752,117.406,101.011,112.926z"/>
        <path class="flame one" fill="#F36E21" d="M55.592,126.854c0,0-3.819,13.29,2.699,16.945C64.038,141.48,55.907,132.263,55.592,126.854z"/>
        <path class="flame two" fill="#F36E21" d="M54.918,104.595c0,0-3.959,6.109-1.24,8.949C56.93,113.256,52.228,107.329,54.918,104.595z"/>
    </svg>


  </div>

 </div>



<br>
<br>
<br>
<br>
<br>
<br>
   <div id = 'progressDiv' ><progress id="dailyCntHTML" max="{{dailyLimit}}" value="{{dailyCount}}"></progress></div>
   

   </br>

   <button id="startBtn"><i class="fas fa-play-circle fa-3x"></i></button>
   </br>

   

  <form id='projectDone' method='post' action= '{{path("totalCountDonePath")}}'>

   <input type='hidden' name = 'projectId' value = '{{ projectId}}'>


  </form>




<form id ="intervalForm" action= '{{ path("showProjectPath", {"projectId": projectId })}}' method="post" >
      <input id='intervalInput' type='hidden' name = 'interval' value = 'off'>
      <input id='pageReload' type='hidden' name = 'pageReload'>
      
</form>

<div style='width: 28%; height: 30px; display: flex; align-items: center; justify-content: flex-start; border: 2px solid white; flex-direction: row; border-radius: 5px; margin: none;'>
      
    <div id='myProgressBar' style='margin-top: 0.5px; background: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/172299/bubbles-mask.gif);  width: 15%; height: 100%; display: flex;  '> 
       
       <div id='liquid' style=' height: 100%; width: 100%; background: linear-gradient(to bottom, #A3E2EF 35%, #4F9CC0);  opacity: 0.8 ; display: flex; justify-content: center; flex-direction: row';><div id='progressText' style=' font-size: 15px; width: 10%; height: 100%; display:flex; justify-content:flex-end; margin-bottom: 80px; margin-right: 24.5px; border-radius: 10px'>

    </div>

 </div>


<a href='{{ path("showGraphPath", {"projectId": projectId }) }}'<button id='chartLink'><i class="fas fa-chart-line fa-3x"></i></button>




</body>

{% endblock %}

      {% block javascripts %}


       
       var liquid = document.getElementById("liquid");

     

         //setInterval (function(){refreshAt(23,55,0)}, 10000000) ;

         
         
         setInterval (function(){storeValues()}, 15000) ;


      
            

            window.onload = function(){

                         totalProgress.innerHTML =  Math.floor( {{ (totalCount/totalLimit) * 100 }}) + ' %';


               if(dailyCountDone == true){

                    document.getElementById('progressDiv').innerHTML = "done :)";



               }
            }
            
               window.onbeforeunload = function(){ storeValues()};


            




      var startBtn = document.getElementById('startBtn'); 
      var dailyCnt = {{dailyCount}};
      var totalCnt = {{ totalCount }};
      var dailyCntHTML = document.getElementById('dailyCntHTML');
      var totalProgress = document.getElementById('totalProgress');
      var dailyCountDone = {{dailyCountDone}};
      var totalCountDone = {{totalCountDone}};
      var intervalInput = document.getElementById('intervalInput');
      var intervalForm = document.getElementById('intervalForm');
      var projectDone = document.getElementById('projectDone');
      var fireLogo = document.getElementById('fireLogo');
              
      var done = false;

      var interval = "{{interval}}";

      var pageReloaded = {{ pageReloaded }}



      if(interval == "on"){

         countFunction();



      }


      
       
       function refreshAt(hours, minutes, seconds) {
    var now = new Date();
    var then = new Date();


    if(now.getHours() > hours ||
       (now.getHours() == hours && now.getMinutes() > minutes) ||
        now.getHours() == hours && now.getMinutes() == minutes && now.getSeconds() >= seconds) {
        then.setDate(now.getDate() + 1);
    }
    then.setHours(hours);
    then.setMinutes(minutes);
    then.setSeconds(seconds);
     

        console.log(then - now);


    
    if((then - now) < 300000){    

         

                   if(startBtn.innerHTML == '<i class="fas fa-pause-circle fa-3x"></i>'){

                      intervalInput.value = 'on';

                      console.log('on!!');
                          }

        
                  console.log('letsgo');

                  storeValues();

                  intervalForm.submit();




            }


      
 }
  

     
   
         


     
     function storeValues(){
         
         xrq = new XMLHttpRequest();
         
         xrq.onload = function(){

         }
          xrq.open('POST', '{{ path("storeCountsPath")}}', true);

          xrq.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

          xrq.send('projectId=' + {{ projectId}} + '&totalCount=' + totalCnt +'&dailyCount=' + dailyCnt);

      }
       
      
   
      var myInterval;


      startBtn.addEventListener('click', function(){

         countFunction();

      })


      function countFunction(){

         
          if (startBtn.innerHTML == '<i class="fas fa-play-circle fa-3x"></i>'){

             myInterval = setInterval(function(){ increaseCounts()}, 1000);
                             
             //doneInterval = setInterval(function(){ myfct()}, 1000);

               fireLogo.style.opacity = 1;

             startBtn.innerHTML = '<i class="fas fa-pause-circle fa-3x"></i>';



          }

          else {
 
             clearInterval(myInterval);
          
             fireLogo.style.opacity = 0;

            
            startBtn.innerHTML = '<i class="fas fa-play-circle fa-3x"></i>';
              
          }



      }


     console.log(dailyCountDone);
     



      function increaseCounts(){ 


         if(totalCnt >= ( (totalCnt.max/100)*90) ){
               if(totalCnt >= {{totalLimit}}){

              myfct();
            }

         }

   
         
        if(dailyCnt >= {{dailyLimit}}) {

           if (dailyCountDone == false){

           

          xrq = new XMLHttpRequest();

          xrq.onload = function(){

              document.getElementById('progressDiv').innerHTML = "done :)";

             
              updateNotifs();

              updatePin();

             console.log(JSON.parse(this.responseText).pin);

             dailyCountDone = true;

          }


          xrq.open('POST', '{{ path("dailyCountDonePath")}}', true);

          xrq.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

          xrq.send('projectId=' + {{ projectId}});

         }


      }

          totalCnt+=1;

          dailyCnt+=1;

          dailyCntHTML.value=dailyCnt;

          totalProgress.innerHTML =  Math.floor(((totalCnt/{{totalLimit}})*100))  + ' %';

       }





        
        function myfct(){

              if(done == false){


           
             if(totalCnt.value >= {{totalLimit}}){


                     
                   console.log('ok');


                    clearInterval(myInterval);

                    storeValues();

                    projectDone.submit();

                    done = true;



                  }


             }



        }



        {% endblock %}
